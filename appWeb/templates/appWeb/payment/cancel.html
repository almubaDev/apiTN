{% extends 'appWeb/base.html' %}
{% load static %}

{% block title %}Pago Cancelado - Tarotnaútica{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-cosmic-900 via-primary-900/30 to-mystic-900/30 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        
        <!-- Header -->
        <div class="text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-times text-3xl text-white"></i>
            </div>
            <h2 class="font-mystical text-3xl font-bold text-cosmic-100 mb-2">
                Pago Cancelado
            </h2>
            <p class="text-cosmic-300">
                Has cancelado el proceso de pago
            </p>
        </div>

        <!-- Content -->
        <div class="bg-cosmic-800/50 backdrop-blur-sm rounded-2xl p-8 border border-cosmic-600 shadow-xl">
            
            <div class="text-center mb-6">
                <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-4 mb-6">
                    <p class="text-orange-300 text-sm">
                        <i class="fas fa-info-circle mr-2"></i>
                        Tu pago ha sido cancelado y no se realizó ningún cargo
                    </p>
                </div>
                
                <p class="text-cosmic-300 leading-relaxed">
                    Puedes intentar realizar el pago nuevamente cuando estés listo. 
                    Tus créditos actuales siguen disponibles para consultas.
                </p>
            </div>

            <!-- Current Credits Display -->
            {% if user.is_authenticated %}
            <div class="mb-6 bg-cosmic-700/30 border border-cosmic-600 rounded-lg p-4">
                <div class="text-center">
                    <div class="text-cosmic-400 text-sm mb-1">Tus Créditos Actuales</div>
                    <div class="text-2xl font-bold text-gold-400" id="currentCredits">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        Cargando...
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Payment Reference (if available) -->
            {% if payment_reference %}
            <div class="mb-6 bg-cosmic-700/20 border border-cosmic-600 rounded-lg p-4">
                <div class="text-xs text-cosmic-400 text-center">
                    <span>Referencia de transacción:</span>
                    <div class="font-mono text-cosmic-300 mt-1">{{ payment_reference }}</div>
                </div>
            </div>
            {% endif %}

            <!-- Actions -->
            <div class="space-y-3">
                <a href="{% url 'appWeb:comprar_creditos' %}" 
                   class="block w-full bg-gradient-to-r from-primary-500 to-mystic-500 hover:from-primary-600 hover:to-mystic-600 text-white text-center py-3 rounded-lg font-medium transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-redo mr-2"></i>Intentar de Nuevo
                </a>
                
                {% if user.is_authenticated %}
                <a href="{% url 'appWeb:sets_list' %}" 
                   class="block w-full border-2 border-cosmic-500 text-cosmic-300 hover:text-cosmic-100 hover:border-cosmic-400 text-center py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-magic mr-2"></i>Continuar con Créditos Actuales
                </a>
                {% endif %}
                
                <a href="{% url 'appWeb:home' %}" 
                   class="block w-full text-cosmic-400 hover:text-cosmic-200 text-center py-2 font-medium transition-colors">
                    <i class="fas fa-home mr-2"></i>Volver al Inicio
                </a>
            </div>
        </div>

        <!-- Alternative Payment Methods -->
        <div class="bg-cosmic-800/30 backdrop-blur-sm rounded-xl p-6 border border-cosmic-700">
            <h3 class="font-mystical text-lg font-semibold text-cosmic-100 mb-4 text-center">
                <i class="fas fa-lightbulb mr-2 text-gold-400"></i>
                Otras Opciones de Pago
            </h3>
            <div class="space-y-3 text-sm text-cosmic-300">
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-primary-400 rounded-full mr-3"></div>
                    <span>Prueba con otro método de pago disponible</span>
                </div>
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-gold-400 rounded-full mr-3"></div>
                    <span>Verifica que tu tarjeta esté habilitada para pagos online</span>
                </div>
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-mystic-400 rounded-full mr-3"></div>
                    <span>Contacta soporte si tienes problemas persistentes</span>
                </div>
            </div>
        </div>

        <!-- Help -->
        <div class="text-center">
            <p class="text-cosmic-400 text-sm">
                ¿Necesitas ayuda? 
                <a href="#" class="text-primary-400 hover:text-primary-300 transition-colors">
                    Contacta al soporte cósmico
                </a>
            </p>
        </div>
    </div>

    <!-- Floating Cosmic Elements -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-orange-400 rounded-full animate-pulse opacity-60"></div>
        <div class="absolute top-1/3 right-1/3 w-1 h-1 bg-red-400 rounded-full animate-ping"></div>
        <div class="absolute bottom-1/4 left-1/3 w-3 h-3 bg-orange-400 rounded-full animate-pulse opacity-40"></div>
        <div class="absolute top-2/3 right-1/4 w-2 h-2 bg-red-300 rounded-full animate-ping opacity-50"></div>
        <div class="absolute bottom-1/3 right-1/2 w-1 h-1 bg-orange-300 rounded-full animate-pulse opacity-70"></div>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Cargar créditos actuales del usuario si está autenticado
    {% if user.is_authenticated %}
    loadCurrentCredits();
    {% endif %}
});

function loadCurrentCredits() {
    fetch('/ajax/verificar-creditos/')
        .then(response => response.json())
        .then(data => {
            const creditsElement = document.getElementById('currentCredits');
            if (creditsElement) {
                creditsElement.innerHTML = `
                    <i class="fas fa-coins mr-2 text-gold-400"></i>
                    ${data.creditos_disponibles || 0}
                `;
            }
        })
        .catch(error => {
            console.error('Error loading credits:', error);
            const creditsElement = document.getElementById('currentCredits');
            if (creditsElement) {
                creditsElement.innerHTML = `
                    <i class="fas fa-exclamation-triangle mr-2 text-orange-400"></i>
                    Error cargando
                `;
            }
        });
}

// Auto-refresh credits every 30 seconds (in case they change)
{% if user.is_authenticated %}
setInterval(loadCurrentCredits, 30000);
{% endif %}
</script>
{% endblock %}
{% endblock %}