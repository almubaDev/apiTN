<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- META TAGS SIMPLES PARA OCULTAR BARRA DEL NAVEGADOR -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    
    <title>{% block title %}Tarotnaútica{% endblock %}</title>
    
    <!-- Tailwind CSS with Custom Colors -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Paleta basada en el logo
                        primary: {
                            50: '#f4f3ff',
                            100: '#ebe9fe', 
                            200: '#d9d6fe',
                            300: '#bfb8fc',
                            400: '#a192f8',
                            500: '#8b5cf6', // Violeta principal del logo
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        mystic: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9', // Rosa místico
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75',
                        },
                        cosmic: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155', // Gris cósmico
                            800: '#1e293b',
                            900: '#0f172a', // Negro cósmico del fondo
                        },
                        gold: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b', // Dorado de las estrellas
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .font-mystical { font-family: 'Cinzel', serif; }
        .font-body { font-family: 'Inter', sans-serif; }

        /* ESTILOS SIMPLES PARA MÓVIL */
        body {
            -webkit-overflow-scrolling: touch;
        }

        /* En móviles, solo un pequeño scroll activa el auto-hide */
        @media screen and (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
        }

        /* Indicador de scroll móvil - CORREGIDO: esquina inferior derecha */
        .scroll-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 40;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        /* Solo visible en móvil */
        @media (min-width: 768px) {
            .scroll-indicator {
                display: none !important;
            }
        }

        /* Estados del indicador - CORREGIDO */
        .scroll-indicator.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .scroll-indicator.hidden {
            opacity: 0;
            transform: translateY(20px) scale(0.8);
            pointer-events: none;
        }

        /* Animación del triángulo */
        .scroll-triangle {
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 16px solid rgba(139, 92, 246, 0.8);
            animation: bounce 2s infinite;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        /* Contenedor del indicador con fondo místico */
        .scroll-indicator-container {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(217, 70, 239, 0.2));
            backdrop-filter: blur(8px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            padding: 12px;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
            60% {
                transform: translateY(-4px);
            }
        }

        /* Variante pulsante para llamar más atención */
        .scroll-indicator.pulse .scroll-indicator-container {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 8px 40px rgba(139, 92, 246, 0.6);
                transform: scale(1.05);
            }
            100% {
                box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
                transform: scale(1);
            }
        }

        /* Versión alternativa con ícono FontAwesome */
        .scroll-icon {
            color: rgba(139, 92, 246, 0.9);
            font-size: 20px;
            animation: bounce 2s infinite;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-cosmic-900 text-cosmic-100 font-body min-h-screen">
    <!-- Navbar -->
    {% include 'appWeb/partials/navbar.html' %}
    
    <!-- Messages -->
    {% if messages %}
        <div class="fixed top-20 right-4 z-50 space-y-2">
            {% for message in messages %}
                <div class="alert-{{ message.tags }} bg-cosmic-800 border-l-4 p-4 rounded-r-lg shadow-lg max-w-sm transform transition-all duration-500 ease-in-out"
                     style="border-left-color: {% if message.tags == 'success' %}#10b981{% elif message.tags == 'error' %}#ef4444{% elif message.tags == 'warning' %}#f59e0b{% else %}#3b82f6{% endif %};">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            {% if message.tags == 'success' %}
                                <i class="fas fa-check-circle text-green-400"></i>
                            {% elif message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle text-red-400"></i>
                            {% elif message.tags == 'warning' %}
                                <i class="fas fa-exclamation-triangle text-gold-400"></i>
                            {% else %}
                                <i class="fas fa-info-circle text-blue-400"></i>
                            {% endif %}
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-cosmic-100">{{ message }}</p>
                        </div>
                        <div class="ml-auto pl-3">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                    class="text-cosmic-400 hover:text-cosmic-200 transition-colors">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <script>
            // Auto-dismiss messages after 5 seconds
            setTimeout(() => {
                document.querySelectorAll('[class*="alert-"]').forEach(alert => {
                    alert.style.transform = 'translateX(100%)';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                });
            }, 5000);
        </script>
    {% endif %}
    
    <!-- Indicador de Scroll Móvil - CORREGIDO: esquina inferior derecha -->
    <div id="scrollIndicator" class="scroll-indicator hidden">
        <div class="scroll-indicator-container">
            <!-- Triángulo CSS -->
            <div class="scroll-triangle"></div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="pt-16">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Scripts -->
    <script>
        // AUTO-SCROLL AL CARGAR PARA OCULTAR BARRA DEL NAVEGADOR
        function autoScrollToHideBar() {
            if (window.innerWidth <= 768) {
                // Scroll suficiente para activar auto-hide (generalmente 50-100px)
                setTimeout(() => {
                    window.scrollTo({
                        top: 80,
                        behavior: 'smooth'
                    });
                }, 200);
            }
        }

        // Cosmic background animation
        function createStars() {
            const starsContainer = document.createElement('div');
            starsContainer.className = 'fixed inset-0 pointer-events-none z-0';
            starsContainer.innerHTML = Array.from({length: 50}, () => {
                const star = document.createElement('div');
                star.className = 'absolute bg-gold-400 rounded-full animate-pulse';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                return star.outerHTML;
            }).join('');
            document.body.appendChild(starsContainer);
        }

        // Indicador de scroll móvil
        function initScrollIndicator() {
            const indicator = document.getElementById('scrollIndicator');
            if (!indicator) return;

            let isVisible = false;
            let lastScrollTop = 0;
            let scrollTimeout;

            function updateScrollIndicator() {
                // Solo en móvil
                if (window.innerWidth >= 768) {
                    indicator.classList.add('hidden');
                    indicator.classList.remove('visible');
                    return;
                }

                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                // Calcular si estamos cerca del final (últimos 100px)
                const scrollBottom = scrollTop + windowHeight;
                const isNearBottom = (documentHeight - scrollBottom) <= 100;
                
                // Calcular si hay contenido suficiente para mostrar el indicador
                const hasScrollableContent = documentHeight > windowHeight + 200;
                
                // Detectar si el usuario está scrolleando hacia abajo
                const isScrollingDown = scrollTop > lastScrollTop;
                
                // Mostrar indicador si:
                // 1. Hay contenido suficiente para scroll
                // 2. No estamos cerca del final
                // 3. El usuario no está en el top absoluto
                const shouldShow = hasScrollableContent && !isNearBottom && scrollTop > 50;
                
                if (shouldShow && !isVisible) {
                    indicator.classList.remove('hidden');
                    indicator.classList.add('visible');
                    isVisible = true;
                    
                    // Agregar efecto pulse al inicio para llamar la atención
                    if (scrollTop < 300) {
                        indicator.classList.add('pulse');
                    }
                } else if (!shouldShow && isVisible) {
                    indicator.classList.add('hidden');
                    indicator.classList.remove('visible', 'pulse');
                    isVisible = false;
                }

                // Remover pulse después de un tiempo
                if (scrollTop > 300) {
                    indicator.classList.remove('pulse');
                }

                lastScrollTop = scrollTop;

                // Auto-hide después de un tiempo sin scroll
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (isVisible && scrollTop > 300) {
                        indicator.style.opacity = '0.5';
                    }
                }, 3000);

                // Restaurar opacidad en nuevo scroll
                indicator.style.opacity = '';
            }

            // Event listeners
            window.addEventListener('scroll', updateScrollIndicator, { passive: true });
            window.addEventListener('resize', updateScrollIndicator);
            
            // Verificación inicial
            setTimeout(updateScrollIndicator, 500);
            
            // Re-verificar después de que el contenido se haya cargado completamente
            window.addEventListener('load', () => {
                setTimeout(updateScrollIndicator, 1000);
            });
        }
        
        // Initialize everything on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            initScrollIndicator();
            
            // AUTO-SCROLL PARA OCULTAR BARRA AL CARGAR
            autoScrollToHideBar();
        });

        // También después de cargar completamente
        window.addEventListener('load', () => {
            setTimeout(autoScrollToHideBar, 300);
        });

        // Función para mostrar/ocultar el indicador manualmente (útil para páginas específicas)
        window.showScrollIndicator = function(show = true) {
            const indicator = document.getElementById('scrollIndicator');
            if (!indicator) return;
            
            if (show) {
                indicator.classList.remove('hidden');
                indicator.classList.add('visible');
            } else {
                indicator.classList.add('hidden');
                indicator.classList.remove('visible');
            }
        };

        // Función para cambiar el estilo del indicador
        window.setScrollIndicatorStyle = function(style = 'triangle') {
            const triangle = document.getElementById('scrollTriangle');
            const icon = document.getElementById('scrollIcon');
            
            if (style === 'triangle' && triangle) {
                triangle.style.display = 'block';
                if (icon) icon.style.display = 'none';
            } else if (style === 'icon' && icon) {
                if (triangle) triangle.style.display = 'none';
                icon.style.display = 'block';
            }
        };
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>