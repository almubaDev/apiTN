{% extends 'appWeb/base.html' %}
{% load static %}

{% block title %}Enlace Enviado - Tarotnaútica{% endblock %}

{% block extra_css %}
<style>
    /* ESTILOS PARA EL CARRUSEL MÓVIL */
    .carousel-container {
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
    }

    .carousel-container::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
    }

    .carousel-slide {
        scroll-snap-align: center;
        scroll-snap-stop: always;
    }

    .carousel-dots {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 16px;
    }

    .carousel-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: rgba(139, 92, 246, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .carousel-dot.active {
        background-color: rgba(139, 92, 246, 1);
        transform: scale(1.2);
    }
</style>
{% endblock %}

{% block content %}
<!-- VERSIÓN MÓVIL - CARRUSEL -->
<div class="md:hidden">
    <!-- Header SIN CAMBIOS -->
    <section class="pt-20 pb-6">
        <div class="max-w-sm mx-auto px-4 text-center">
            <div class="flex items-center justify-center mb-6">
                <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-mystic-500 rounded-full flex items-center justify-center mr-3 relative">
                    <i class="fas fa-check text-2xl text-white" id="checkIcon"></i>
                    <div class="absolute inset-0 rounded-full border-2 border-green-400 animate-ping opacity-30"></div>
                </div>
                <h1 class="font-mystical text-2xl font-bold text-cosmic-100">
                    ¡Enlace Enviado!
                </h1>
            </div>
            <p class="text-sm text-cosmic-300">
                Sigue los pasos para completar la recuperación
            </p>
        </div>
    </section>

    <!-- Carrusel de Steps -->
    <section class="pb-8">
        <div class="carousel-container flex overflow-x-auto gap-4 px-4 pb-4" id="mobileCarousel">

            <!-- Step 1: Confirmación -->
            <div class="carousel-slide flex-shrink-0 w-80 max-w-[85vw]">
                <div class="bg-cosmic-800/80 backdrop-blur-sm rounded-2xl border border-cosmic-600 p-6 h-[420px] flex flex-col">
                    <div class="text-center mb-4">
                        <h3 class="font-mystical text-lg font-semibold text-green-300 mb-1">
                            <i class="fas fa-paper-plane mr-2 text-green-400"></i>
                            Email Enviado Exitosamente
                        </h3>
                    </div>

                    <div class="flex-1 flex flex-col justify-center">
                        <div class="text-center mb-4">
                            <div class="inline-flex items-center justify-center w-16 h-16 bg-green-500/20 rounded-full mb-4">
                                <i class="fas fa-check-circle text-2xl text-green-400"></i>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-cosmic-700/30 rounded-lg p-4 border border-green-500/20">
                                <p class="text-cosmic-200 text-sm leading-relaxed text-center">
                                    Te hemos enviado un enlace de recuperación a tu dirección de email.
                                </p>
                            </div>

                            <div class="bg-cosmic-700/30 rounded-lg p-4 border border-cosmic-600">
                                <p class="text-cosmic-300 text-sm leading-relaxed text-center">
                                    El mensaje debería llegar en los próximos minutos. Si no lo ves, revisa tu carpeta de spam.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Instrucciones -->
            <div class="carousel-slide flex-shrink-0 w-80 max-w-[85vw]">
                <div class="bg-cosmic-800/80 backdrop-blur-sm rounded-2xl border border-cosmic-600 p-6 h-[420px] flex flex-col">
                    <div class="text-center mb-4">
                        <h3 class="font-mystical text-lg font-semibold text-mystic-300 mb-1">
                            <i class="fas fa-list-ol mr-2 text-mystic-400"></i>
                            Próximos Pasos
                        </h3>
                    </div>

                    <div class="flex-1 flex flex-col justify-center space-y-4">
                        <div class="bg-mystic-900/20 border border-mystic-500/30 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <span class="inline-flex items-center justify-center w-6 h-6 bg-mystic-500 text-white text-sm rounded-full flex-shrink-0">1</span>
                                <div>
                                    <h4 class="font-semibold text-mystic-300 text-sm mb-1">Revisa tu Email</h4>
                                    <p class="text-cosmic-300 text-xs">Busca en tu bandeja de entrada y carpeta de spam</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-mystic-900/20 border border-mystic-500/30 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <span class="inline-flex items-center justify-center w-6 h-6 bg-mystic-500 text-white text-sm rounded-full flex-shrink-0">2</span>
                                <div>
                                    <h4 class="font-semibold text-mystic-300 text-sm mb-1">Haz Clic en el Enlace</h4>
                                    <p class="text-cosmic-300 text-xs">Abre el enlace que te enviamos por email</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-mystic-900/20 border border-mystic-500/30 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <span class="inline-flex items-center justify-center w-6 h-6 bg-mystic-500 text-white text-sm rounded-full flex-shrink-0">3</span>
                                <div>
                                    <h4 class="font-semibold text-mystic-300 text-sm mb-1">Crea tu Nueva Contraseña</h4>
                                    <p class="text-cosmic-300 text-xs">Establece una contraseña segura y única</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Información Importante -->
            <div class="carousel-slide flex-shrink-0 w-80 max-w-[85vw]">
                <div class="bg-cosmic-800/80 backdrop-blur-sm rounded-2xl border border-cosmic-600 p-6 h-[420px] flex flex-col">
                    <div class="text-center mb-4">
                        <h3 class="font-mystical text-lg font-semibold text-gold-300 mb-1">
                            <i class="fas fa-clock mr-2 text-gold-400"></i>
                            Información Importante
                        </h3>
                    </div>

                    <div class="flex-1 flex flex-col justify-center space-y-4">
                        <div class="bg-gold-900/20 border border-gold-500/30 rounded-lg p-4">
                            <div class="flex items-center space-x-3 mb-2">
                                <i class="fas fa-stopwatch text-gold-400"></i>
                                <h4 class="font-semibold text-gold-300 text-sm">Tiempo Límite</h4>
                            </div>
                            <p class="text-cosmic-300 text-sm">El enlace expira en <strong>1 hora</strong> por seguridad</p>
                        </div>

                        <div class="bg-gold-900/20 border border-gold-500/30 rounded-lg p-4">
                            <div class="flex items-center space-x-3 mb-2">
                                <i class="fas fa-key text-gold-400"></i>
                                <h4 class="font-semibold text-gold-300 text-sm">Uso Único</h4>
                            </div>
                            <p class="text-cosmic-300 text-sm">Solo puedes usar el enlace <strong>una vez</strong></p>
                        </div>

                        <div class="bg-gold-900/20 border border-gold-500/30 rounded-lg p-3">
                            <div class="flex items-center space-x-2 mb-2">
                                <i class="fas fa-shield-alt text-gold-400"></i>
                                <h4 class="font-semibold text-gold-300 text-sm">Seguridad</h4>
                            </div>
                            <p class="text-cosmic-300 text-xs">El enlace es completamente seguro y encriptado</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Acciones y Consejos -->
            <div class="carousel-slide flex-shrink-0 w-80 max-w-[85vw]">
                <div class="bg-cosmic-800/80 backdrop-blur-sm rounded-2xl border border-cosmic-600 p-6 h-[420px] flex flex-col">
                    <div class="text-center mb-4">
                        <h3 class="font-mystical text-lg font-semibold text-primary-300 mb-1">
                            <i class="fas fa-lightbulb mr-2 text-primary-400"></i>
                            Consejos y Acciones
                        </h3>
                    </div>

                    <div class="flex-1 flex flex-col justify-center space-y-4">
                        <!-- Consejos útiles -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-cosmic-700/30 rounded-lg p-3 border border-cosmic-600 text-center">
                                <i class="fas fa-envelope text-primary-400 text-lg mb-2"></i>
                                <p class="text-xs text-cosmic-300">Revisa todas las carpetas</p>
                            </div>
                            <div class="bg-cosmic-700/30 rounded-lg p-3 border border-cosmic-600 text-center">
                                <i class="fas fa-mobile-alt text-mystic-400 text-lg mb-2"></i>
                                <p class="text-xs text-cosmic-300">Funciona en móvil</p>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="space-y-3">
                            <button onclick="resendEmail()"
                                    id="resendBtn"
                                    class="w-full py-3 px-4 border-2 border-mystic-500 text-mystic-400 rounded-lg hover:bg-mystic-500/10 transition-all duration-300 font-medium text-sm">
                                <i class="fas fa-redo mr-2"></i>
                                <span id="resendText">Reenviar Email</span>
                            </button>

                            <a href="{% url 'appWeb:login' %}"
                               class="block w-full py-3 px-4 bg-gradient-to-r from-primary-500 to-mystic-500 hover:from-primary-600 hover:to-mystic-600 text-white text-center rounded-lg font-medium transition-all duration-300 text-sm">
                                <i class="fas fa-arrow-left mr-2"></i>Volver al Login
                            </a>
                        </div>

                        <!-- Help -->
                        <div class="text-center pt-2">
                            <p class="text-cosmic-400 text-xs mb-1">¿Problemas?</p>
                            <a href="#" class="text-primary-400 hover:text-primary-300 transition-colors text-xs">
                                Contactar Soporte
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Indicadores de posición (puntos) -->
        <div class="carousel-dots" id="carouselDots">
            <div class="carousel-dot active" data-slide="0"></div>
            <div class="carousel-dot" data-slide="1"></div>
            <div class="carousel-dot" data-slide="2"></div>
            <div class="carousel-dot" data-slide="3"></div>
        </div>
    </section>
</div>

<!-- VERSIÓN DESKTOP - Sin cambios -->
<div class="hidden md:block min-h-screen flex items-center justify-center bg-gradient-to-br from-cosmic-900 via-primary-900/30 to-mystic-900/30 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <!-- Success Animation Container -->
        <div class="text-center">
            <div class="mx-auto h-20 w-20 flex items-center justify-center rounded-full bg-gradient-to-br from-green-500 to-mystic-500 mb-6 relative">
                <i class="fas fa-check text-3xl text-white" id="checkIcon"></i>
                <!-- Success ring animation -->
                <div class="absolute inset-0 rounded-full border-2 border-green-400 animate-ping opacity-30"></div>
            </div>
            <h2 class="font-mystical text-3xl font-bold text-cosmic-100 mb-2">
                ¡Enlace Enviado!
            </h2>
            <p class="text-cosmic-300">
                Revisa tu bandeja de entrada cósmica
            </p>
        </div>

        <!-- Main Content -->
        <div class="bg-cosmic-800/50 backdrop-blur-sm rounded-2xl p-8 border border-cosmic-600 shadow-xl">

            <!-- Success Message -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-green-500/20 rounded-full mb-4">
                    <i class="fas fa-paper-plane text-2xl text-green-400"></i>
                </div>
                <h3 class="font-mystical text-xl font-semibold text-cosmic-100 mb-3">
                    Email Enviado Exitosamente
                </h3>
                <p class="text-cosmic-300 text-sm leading-relaxed">
                    Te hemos enviado un enlace de recuperación a tu dirección de email.
                    El mensaje debería llegar en los próximos minutos.
                </p>
            </div>

            <!-- Instructions -->
            <div class="bg-mystic-900/20 border border-mystic-500/30 rounded-lg p-6 mb-6">
                <h4 class="font-semibold text-mystic-300 mb-3 flex items-center">
                    <i class="fas fa-list-ol mr-2"></i>
                    Próximos Pasos:
                </h4>
                <ol class="space-y-2 text-sm text-cosmic-300">
                    <li class="flex items-start">
                        <span class="inline-flex items-center justify-center w-5 h-5 bg-mystic-500 text-white text-xs rounded-full mr-3 mt-0.5 flex-shrink-0">1</span>
                        <span>Revisa tu bandeja de entrada (y spam/promociones)</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-flex items-center justify-center w-5 h-5 bg-mystic-500 text-white text-xs rounded-full mr-3 mt-0.5 flex-shrink-0">2</span>
                        <span>Haz clic en el enlace del email</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-flex items-center justify-center w-5 h-5 bg-mystic-500 text-white text-xs rounded-full mr-3 mt-0.5 flex-shrink-0">3</span>
                        <span>Crea tu nueva contraseña mística</span>
                    </li>
                </ol>
            </div>

            <!-- Important Info -->
            <div class="bg-gold-900/20 border border-gold-500/30 rounded-lg p-4 mb-6">
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                        <i class="fas fa-clock text-gold-400 mt-0.5"></i>
                    </div>
                    <div class="text-sm">
                        <p class="font-medium text-gold-300 mb-1">⏰ Información Importante</p>
                        <ul class="space-y-1 text-cosmic-300 text-xs">
                            <li>• El enlace expira en <strong>1 hora</strong> por seguridad</li>
                            <li>• Solo puedes usar el enlace <strong>una vez</strong></li>
                            <li>• Si no ves el email, revisa tu carpeta de spam</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="space-y-4">
                <!-- Resend Button -->
                <button onclick="resendEmail()"
                        id="resendBtn"
                        class="w-full py-3 px-4 border-2 border-mystic-500 text-mystic-400 rounded-lg hover:bg-mystic-500/10 transition-all duration-300 font-medium">
                    <i class="fas fa-redo mr-2"></i>
                    <span id="resendText">Reenviar Email</span>
                </button>

                <!-- Back to Login -->
                <a href="{% url 'appWeb:login' %}"
                   class="block w-full py-3 px-4 bg-gradient-to-r from-primary-500 to-mystic-500 hover:from-primary-600 hover:to-mystic-600 text-white text-center rounded-lg font-medium transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Volver al Inicio de Sesión
                </a>
            </div>

            <!-- Help -->
            <div class="mt-8 text-center">
                <p class="text-cosmic-400 text-sm mb-2">¿Problemas para recibir el email?</p>
                <div class="space-x-4 text-xs">
                    <a href="#" class="text-primary-400 hover:text-primary-300 transition-colors">
                        Centro de Ayuda
                    </a>
                    <span class="text-cosmic-600">•</span>
                    <a href="#" class="text-primary-400 hover:text-primary-300 transition-colors">
                        Contactar Soporte
                    </a>
                </div>
            </div>
        </div>

        <!-- Email Tips -->
        <div class="bg-cosmic-800/30 backdrop-blur-sm rounded-xl p-6 border border-cosmic-700">
            <h3 class="font-mystical text-lg font-semibold text-cosmic-100 mb-4 text-center">
                <i class="fas fa-lightbulb mr-2 text-gold-400"></i>
                Consejos Útiles
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-cosmic-300">
                <div class="flex items-start space-x-2">
                    <i class="fas fa-envelope text-primary-400 mt-1 flex-shrink-0"></i>
                    <span>Revisa todas las carpetas de tu email</span>
                </div>
                <div class="flex items-start space-x-2">
                    <i class="fas fa-mobile-alt text-mystic-400 mt-1 flex-shrink-0"></i>
                    <span>Funciona en cualquier dispositivo</span>
                </div>
                <div class="flex items-start space-x-2">
                    <i class="fas fa-shield-alt text-gold-400 mt-1 flex-shrink-0"></i>
                    <span>Enlace completamente seguro</span>
                </div>
                <div class="flex items-start space-x-2">
                    <i class="fas fa-clock text-green-400 mt-1 flex-shrink-0"></i>
                    <span>Válido por 60 minutos</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Cosmic Elements -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-green-400 rounded-full animate-pulse opacity-60"></div>
        <div class="absolute top-1/3 right-1/3 w-1 h-1 bg-mystic-400 rounded-full animate-ping"></div>
        <div class="absolute bottom-1/4 left-1/3 w-3 h-3 bg-gold-400 rounded-full animate-pulse opacity-40"></div>
        <div class="absolute top-2/3 right-1/4 w-2 h-2 bg-green-300 rounded-full animate-ping opacity-50"></div>
        <div class="absolute bottom-1/3 right-1/2 w-1 h-1 bg-mystic-300 rounded-full animate-pulse opacity-70"></div>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('mobileCarousel');
    const dots = document.querySelectorAll('.carousel-dot');

    if (!carousel || dots.length === 0) return;

    let currentSlide = 0;
    const totalSlides = dots.length;

    // Función para actualizar los dots
    function updateDots() {
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentSlide);
        });
    }

    // Función para ir a un slide específico
    function goToSlide(slideIndex) {
        const slideWidth = carousel.scrollWidth / totalSlides;
        carousel.scrollTo({
            left: slideWidth * slideIndex,
            behavior: 'smooth'
        });
        currentSlide = slideIndex;
        updateDots();
    }

    // Event listener para los dots
    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            goToSlide(index);
        });
    });

    // Detectar scroll manual y actualizar dots
    let scrollTimeout;
    carousel.addEventListener('scroll', () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
            const slideWidth = carousel.scrollWidth / totalSlides;
            const newSlide = Math.round(carousel.scrollLeft / slideWidth);

            if (newSlide !== currentSlide && newSlide >= 0 && newSlide < totalSlides) {
                currentSlide = newSlide;
                updateDots();
            }
        }, 150);
    });

    // Touch events para mejor experiencia móvil
    let startX = null;
    let scrollLeft = null;

    carousel.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        scrollLeft = carousel.scrollLeft;
    });

    carousel.addEventListener('touchmove', (e) => {
        if (!startX) return;

        const currentX = e.touches[0].clientX;
        const diff = startX - currentX;
        carousel.scrollLeft = scrollLeft + diff;
    });

    carousel.addEventListener('touchend', () => {
        startX = null;
        scrollLeft = null;

        // Snap to nearest slide
        const slideWidth = carousel.scrollWidth / totalSlides;
        const newSlide = Math.round(carousel.scrollLeft / slideWidth);

        if (newSlide >= 0 && newSlide < totalSlides) {
            goToSlide(newSlide);
        }
    });

    // Animate check icon on load
    setTimeout(() => {
        const checkIcon = document.getElementById('checkIcon');
        if (checkIcon) {
            checkIcon.style.transform = 'scale(1.2)';
            setTimeout(() => {
                checkIcon.style.transform = 'scale(1)';
            }, 200);
        }
    }, 500);
});

function resendEmail() {
    const resendBtn = document.getElementById('resendBtn');
    const resendText = document.getElementById('resendText');

    // Disable button temporarily
    resendBtn.disabled = true;
    resendBtn.classList.add('opacity-50', 'cursor-not-allowed');
    resendText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Reenviando...';

    // Simulate resend (you can replace with actual AJAX call)
    setTimeout(() => {
        resendText.innerHTML = '<i class="fas fa-check mr-2"></i>¡Reenviado!';

        // Reset after 3 seconds
        setTimeout(() => {
            resendBtn.disabled = false;
            resendBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            resendText.innerHTML = '<i class="fas fa-redo mr-2"></i>Reenviar Email';
        }, 3000);
    }, 2000);
}
</script>
{% endblock %}
{% endblock %}